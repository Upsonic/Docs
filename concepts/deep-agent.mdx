---
title: "Deep Agent"
description: "Give your agents advanced capabilities for complex, multi-step tasks"
---

## Overview

### What is Deep Agent?

Deep Agent extends the base Agent with powerful capabilities for handling complex, multi-step tasks that require planning, file management, and task delegation. It provides:

- **Planning and Todo Management** - Break down multi-step objectives into manageable todos with status tracking
- **Virtual Filesystem** - Create, read, edit, and organize files in an isolated filesystem
- **Subagent System** - Spawn specialized agents for focused, isolated work
- **Automatic Completion Loop** - Ensures all todos are completed before finishing (up to 10 iterations)
- **Persistent Memory** - Maintains context and files across complex workflows using InMemoryStorage

### How Deep Agent Works

Deep Agent operates with an automatic completion loop that ensures all tasks are finished:

**Before Each Task:**
1. Sets up todo management tools (write_todos)
2. Initializes virtual filesystem (ls, read_file, write_file, edit_file)
3. Prepares subagent delegation system (task tool)
4. Loads any existing state from DeepAgentState

**During Task Execution:**
1. Agent creates todos for complex tasks using write_todos
2. Works through todos systematically
3. Uses virtual files to organize work
4. Delegates to subagents when beneficial
5. Updates todo status in real-time (pending → in_progress → completed)

**After Task Execution:**
1. Checks if all todos are completed
2. If incomplete, creates continuation tasks automatically
3. Repeats until all work is finished (max 10 iterations)
4. Ensures all deliverables are created

## Attributes

The DeepAgent class accepts the following initialization parameters:

| Attribute | Type | Default | Description |
|-----------|------|---------|-------------|
| `model` | `str` or `Model` | `"openai/gpt-4o"` | Model identifier or Model instance |
| `subagents` | `List[Agent]` | `None` | List of Agent instances to use as subagents (each must have a name) |
| `instructions` | `str` | `None` | Additional instructions to append to system prompt |
| `tool_call_limit` | `int` | `100` | Maximum tool calls per execution |
| `memory` | `Memory` | Auto-created | Memory instance (auto-created with InMemoryStorage if not provided) |
| `**kwargs` | | | Additional arguments passed to base Agent |

**DeepAgentState Attributes:**

| Attribute | Type | Description |
|-----------|------|-------------|
| `todos` | `List[Todo]` | List of todo items for task planning and tracking |
| `files` | `Dict[str, str]` | Virtual filesystem mapping file paths to content |

**Todo Model:**

| Attribute | Type | Values | Description |
|-----------|------|--------|-------------|
| `content` | `str` | | Description of the task to complete |
| `status` | `Literal` | `"pending"`, `"in_progress"`, `"completed"` | Current status of the task |

## Capabilities

### Planning

Deep Agent uses the `write_todos` tool to create and manage structured task lists for complex work sessions.

**Usage:**

The agent automatically uses this tool when:
- Tasks require 3 or more distinct steps
- Tasks are non-trivial and require careful planning
- User explicitly requests todo list
- User provides multiple tasks
- Future revisions may be needed based on intermediate results

**Parameters:**

```python
write_todos(todos: List[Todo]) -> str
```

| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `todos` | `List[Todo]` | Yes | List of Todo objects with 'content' and 'status' fields |

**Return Value:** Confirmation message with the updated todo list.

**Example:**

```python
from upsonic import DeepAgent, Task

agent = DeepAgent("openai/gpt-4o")
task = Task("""
Create a complete web application with:
- User authentication system
- Product catalog with search
- Shopping cart functionality
- Payment processing
""")

result = agent.do(task)
# Agent creates todos, works through them, and ensures all are completed
```

### To-Do Management

Deep Agent provides automatic todo tracking and completion enforcement.

**Usage:**

Todos follow a strict lifecycle:
1. Created as `"pending"` or `"in_progress"`
2. Marked `"in_progress"` before starting work
3. Marked `"completed"` immediately after finishing
4. Agent continues until ALL todos are `"completed"`

**Automatic Completion Loop:**

The agent automatically:
- Checks todo completion after each execution
- Creates continuation tasks for incomplete todos
- Repeats up to 10 iterations (MAX_COMPLETION_ITERATIONS)
- Provides debug output showing progress (completed/total)

**Managing Todos Programmatically:**

```python
# Get current todos
todos = agent.get_todos()
# Returns: [{"content": "...", "status": "..."}, ...]

# Access state directly
state = agent.deep_agent_state
todos = state.todos  # List[Todo]
```

### Virtual File System

Deep Agent provides an isolated virtual filesystem for file operations during task execution.

**Usage:**

Files are stored in the `deep_agent_state.files` dictionary and persist across the completion loop.

**Available Tools:**

#### ls
List all files in the virtual filesystem.

```python
ls() -> List[str]
```

**Return Value:** List of file paths.

#### read_file
Read a file from the virtual filesystem with optional pagination.

```python
read_file(file_path: str, offset: int = 0, limit: int = 2000) -> str
```

| Parameter | Type | Default | Description |
|-----------|------|---------|-------------|
| `file_path` | `str` | Required | Absolute path to the file to read |
| `offset` | `int` | `0` | Line number to start reading from (0-based) |
| `limit` | `int` | `2000` | Maximum number of lines to read |

**Return Value:** File content with line numbers (cat -n format), or error message if file not found.

**Notes:**
- Line numbers start at 1
- Lines longer than 2000 characters are truncated
- Empty files return system reminder

#### write_file
Create or overwrite a file in the virtual filesystem.

```python
write_file(file_path: str, content: str) -> str
```

| Parameter | Type | Description |
|-----------|------|-------------|
| `file_path` | `str` | Absolute path where the file should be written |
| `content` | `str` | Content to write to the file |

**Return Value:** Confirmation message.

#### edit_file
Perform exact string replacement in a file.

```python
edit_file(file_path: str, old_string: str, new_string: str, replace_all: bool = False) -> str
```

| Parameter | Type | Default | Description |
|-----------|------|---------|-------------|
| `file_path` | `str` | Required | Absolute path to the file to edit |
| `old_string` | `str` | Required | Exact string to find and replace |
| `new_string` | `str` | Required | String to replace old_string with |
| `replace_all` | `bool` | `False` | If True, replace all occurrences; if False, require uniqueness |

**Return Value:** Confirmation message or error if string not found/not unique.

**Managing Files Programmatically:**

```python
from upsonic import DeepAgent, Task

agent = DeepAgent("openai/gpt-4o")

# Add initial files
agent.add_file("/app/main.py", "print('Hello World')")
agent.add_file("/app/requirements.txt", "flask==2.0.1")

# Or set multiple files at once
agent.set_files({
    "/project/README.md": "# My Project",
    "/project/src/main.py": "def main():\n    print('Hello')"
})

# Get all files
files = agent.get_files()
# Returns: {"/app/main.py": "...", "/app/requirements.txt": "..."}

task = Task("Review the code and add error handling")
result = agent.do(task)
```

### File Management

File management in Deep Agent is handled through the virtual filesystem capability (see Virtual File System section above).

### Subagent Generation

Deep Agent can spawn specialized subagents to handle complex, multi-step independent tasks with isolated context.

**Usage:**

The `task` tool is automatically created and injected into the agent's toolset. It allows spawning:
- **general-purpose agents** - Full-featured agents with all tools for research and complex tasks
- **Custom named agents** - Specialized agents you define and pass to DeepAgent

**Parameters:**

```python
task(description: str, subagent_type: str) -> str
```

| Parameter | Type | Description |
|-----------|------|-------------|
| `description` | `str` | Detailed task description for the subagent to complete autonomously |
| `subagent_type` | `str` | Type of subagent: `"general-purpose"` or custom agent name |

**Return Value:** The final result from the subagent's execution.

**Available Subagent Types:**

1. **general-purpose**: Automatically available, created with same model as parent agent
2. **Custom agents**: Agents you provide in the `subagents` parameter

**When to Use Subagents:**

- Complex independent tasks that can be fully delegated
- Parallel processing of multiple related tasks
- Specialized expertise requiring focused knowledge
- Context isolation for heavy token usage
- Quality assurance with review and validation

**Creating Custom Subagents:**

```python
from upsonic import DeepAgent, Agent, Task

# Create specialized agents with names
researcher = Agent(
    "openai/gpt-4o",
    name="researcher",
    system_prompt="You are a research expert focused on gathering information"
)

code_reviewer = Agent(
    "openai/gpt-4o",
    name="code-reviewer",
    system_prompt="You are a code review expert focused on quality and best practices"
)

# Create Deep Agent with subagents
agent = DeepAgent(
    "openai/gpt-4o",
    subagents=[researcher, code_reviewer]
)

task = Task("Research AI trends and create a technical report with code examples")
result = agent.do(task)
# Agent can delegate research to researcher and code review to code-reviewer
```

**Adding Subagents Dynamically:**

```python
agent = DeepAgent("openai/gpt-4o")

# Add subagent after creation
analyst = Agent("openai/gpt-4o", name="analyst", system_prompt="Data analysis expert")
agent.add_subagent(analyst)
```

**Important Notes:**

- Subagents execute autonomously and return a single result
- Subagents have isolated context (no memory sharing)
- Subagent results are not visible to the user directly
- Each subagent must have a `name` attribute set

## Advanced

### Performance Optimization

**Parallelization:**
- Launch multiple subagents concurrently for independent tasks
- Use general-purpose agents to isolate context and reduce token usage
- Each subagent processes work independently and returns synthesized results

**Model Selection:**
- Use appropriate models based on task complexity
- DeepAgent inherits all model selection capabilities from base Agent
- Can override model for specific executions

**Monitoring:**
- Track todo status with `get_todos()`
- Monitor completion progress in debug mode
- Access files at any time with `get_files()`

### Quality Assurance

**Todo Completion Enforcement:**
- Automatic verification that all todos are completed
- Up to 10 continuation iterations if todos remain incomplete
- Debug warnings if max iterations reached with incomplete todos

**File Validation:**
- All file operations return confirmation or error messages
- Read before edit enforcement in prompts
- Exact string matching for edit operations

**Subagent Quality:**
- Subagents can be specialized for review and validation
- Results can be verified by main agent before proceeding
- Isolated context prevents subagent errors from affecting main agent

## Examples

### Basic Deep Agent Example

#### About Example Scenario

A simple example demonstrating Deep Agent's core capabilities: automatic todo creation, file management, and completion tracking for building a basic application.

#### Deep Agent Configuration

```python
from upsonic import DeepAgent, Task

agent = DeepAgent("openai/gpt-4o")
```

This creates a basic Deep Agent with:
- Default model: GPT-4o
- Auto-created InMemoryStorage-based memory
- Tool call limit: 100
- All default Deep Agent tools enabled

#### Full Code

```python
from upsonic import DeepAgent, Task

# Create a Deep Agent
agent = DeepAgent("openai/gpt-4o")

# Complex task that benefits from planning
task = Task("Analyze the codebase and create a comprehensive report with recommendations")
result = agent.do(task)

# The agent will automatically:
# 1. Create a todo list to plan the work
# 2. Use virtual files to organize findings
# 3. Complete all tasks before finishing

print(result)
```

### Software Developer Agent

#### About Example Scenario

A comprehensive software development workflow using Deep Agent with specialized subagents for different aspects of development (frontend, backend, testing).

#### Deep Agent Configuration

```python
from upsonic import DeepAgent, Agent, Task

# Create specialized development team
frontend_dev = Agent(
    "openai/gpt-4o",
    name="frontend",
    system_prompt="You are a frontend development expert specializing in React and modern web technologies"
)

backend_dev = Agent(
    "openai/gpt-4o",
    name="backend",
    system_prompt="You are a backend development expert specializing in Node.js, Python, and database design"
)

tester = Agent(
    "openai/gpt-4o",
    name="tester",
    system_prompt="You are a QA and testing expert focused on automation and comprehensive test coverage"
)

# Create Deep Agent with specialized team
agent = DeepAgent(
    "openai/gpt-4o",
    subagents=[frontend_dev, backend_dev, tester]
)
```

#### Full Code

```python
from upsonic import DeepAgent, Agent, Task

# Create specialized development team
frontend_dev = Agent(
    "openai/gpt-4o",
    name="frontend",
    system_prompt="You are a frontend development expert specializing in React and modern web technologies"
)

backend_dev = Agent(
    "openai/gpt-4o",
    name="backend",
    system_prompt="You are a backend development expert specializing in Node.js, Python, and database design"
)

tester = Agent(
    "openai/gpt-4o",
    name="tester",
    system_prompt="You are a QA and testing expert focused on automation and comprehensive test coverage"
)

# Create Deep Agent with specialized team
agent = DeepAgent(
    "openai/gpt-4o",
    subagents=[frontend_dev, backend_dev, tester]
)

# Execute complex development project
task = Task("""
Build a complete task management application:
- User authentication and authorization
- Task CRUD operations
- Real-time updates
- Mobile-responsive design
- Unit and integration tests
- Deployment configuration
""")

result = agent.do(task)
print(result)
```

### Research and Analysis Agent

#### About Example Scenario

A research workflow that uses Deep Agent to conduct comprehensive analysis with specialized subagents for data analysis, research, and writing.

#### Deep Agent Configuration

```python
from upsonic import DeepAgent, Agent, Task

# Create research team
data_analyst = Agent(
    "openai/gpt-4o",
    name="data-analyst",
    system_prompt="You are a data analysis and statistics expert"
)

researcher = Agent(
    "openai/gpt-4o",
    name="researcher",
    system_prompt="You are a research and information gathering expert"
)

writer = Agent(
    "openai/gpt-4o",
    name="writer",
    system_prompt="You are a technical writing and report creation expert"
)

# Create Deep Agent with research team
agent = DeepAgent(
    "openai/gpt-4o",
    subagents=[data_analyst, researcher, writer]
)
```

#### Full Code

```python
from upsonic import DeepAgent, Agent, Task

# Create research team
data_analyst = Agent(
    "openai/gpt-4o",
    name="data-analyst",
    system_prompt="You are a data analysis and statistics expert"
)

researcher = Agent(
    "openai/gpt-4o",
    name="researcher",
    system_prompt="You are a research and information gathering expert"
)

writer = Agent(
    "openai/gpt-4o",
    name="writer",
    system_prompt="You are a technical writing and report creation expert"
)

# Create Deep Agent with research team
agent = DeepAgent(
    "openai/gpt-4o",
    subagents=[data_analyst, researcher, writer]
)

# Execute comprehensive research project
task = Task("""
Conduct comprehensive market research on AI tools:
- Analyze market trends and competitors
- Gather data on user preferences
- Create detailed report with recommendations
- Include charts and visualizations
""")

result = agent.do(task)
print(result)
```

### Content Creation Agent

#### About Example Scenario

A content creation workflow using Deep Agent with specialized subagents for research, writing, and review to produce high-quality content.

#### Deep Agent Configuration

```python
from upsonic import DeepAgent, Agent, Task

# Create content creation team
researcher = Agent(
    "openai/gpt-4o",
    name="researcher",
    system_prompt="You are a research and fact-checking expert"
)

writer = Agent(
    "openai/gpt-4o",
    name="writer",
    system_prompt="You are a content writing and editing expert"
)

reviewer = Agent(
    "openai/gpt-4o",
    name="reviewer",
    system_prompt="You are a content review and quality assurance expert"
)

# Create Deep Agent with content team
agent = DeepAgent(
    "openai/gpt-4o",
    subagents=[researcher, writer, reviewer]
)
```

#### Full Code

```python
from upsonic import DeepAgent, Agent, Task

# Create content creation team
researcher = Agent(
    "openai/gpt-4o",
    name="researcher",
    system_prompt="You are a research and fact-checking expert"
)

writer = Agent(
    "openai/gpt-4o",
    name="writer",
    system_prompt="You are a content writing and editing expert"
)

reviewer = Agent(
    "openai/gpt-4o",
    name="reviewer",
    system_prompt="You are a content review and quality assurance expert"
)

# Create Deep Agent with content team
agent = DeepAgent(
    "openai/gpt-4o",
    subagents=[researcher, writer, reviewer]
)

# Execute content creation project
task = Task("""
Create a comprehensive blog post series about machine learning:
- Research latest trends and developments
- Write 5 detailed articles with examples
- Include code samples and tutorials
- Review for accuracy and clarity
- Format for web publication
""")

result = agent.do(task)
print(result)
```
