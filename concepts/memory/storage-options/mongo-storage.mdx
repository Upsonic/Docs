---
title: "MongoStorage"
description: "MongoDB storage for scalable document-based systems"
---

## Usage

```python
from upsonic import Agent, Task
from upsonic.storage import Memory
from upsonic.storage.providers.mongo import MongoStorage

# Create MongoDB storage and memory
storage = MongoStorage(
    db_url="mongodb://localhost:27017",
    database_name="agent_memory",
    sessions_collection_name="interaction_sessions",
    profiles_collection_name="user_profiles"
)
memory = Memory(
    storage=storage,
    session_id="session_001",
    user_id="user_123",
    full_session_memory=True,
    summary_memory=True,
    user_analysis_memory=True,
    model="openai/gpt-4o"
)

# Create agent with memory
agent = Agent("openai/gpt-4o", memory=memory)

# First conversation
task1 = Task("My name is Alice and I love Python")
result1 = agent.do(task1)

# Second conversation - agent remembers
task2 = Task("What's my name and favorite language?")
result2 = agent.do(task2)
print(result2)  # Output: Your name is Alice and you love Python
```

### MongoDB with Authentication

```python
from upsonic import Agent, Task
from upsonic.storage import Memory
from upsonic.storage.providers.mongo import MongoStorage

# MongoDB with authentication
storage = MongoStorage(
    db_url="mongodb://user:password@localhost:27017/agentdb",
    database_name="production_memory",
    sessions_collection_name="sessions",
    profiles_collection_name="profiles"
)
memory = Memory(
    storage=storage,
    session_id="session_001",
    full_session_memory=True
)

agent = Agent("openai/gpt-4o", memory=memory)

task1 = Task("Help me design a document schema")
result1 = agent.do(task1)

task2 = Task("How should I handle relationships in it?")
result2 = agent.do(task2)
print(result2)
```

### With Pre-existing Client

```python
from motor.motor_asyncio import AsyncIOMotorClient
from upsonic import Agent, Task
from upsonic.storage import Memory
from upsonic.storage.providers.mongo import MongoStorage

client = AsyncIOMotorClient("mongodb://localhost:27017")
storage = MongoStorage(client=client, database_name="agent_memory")
memory = Memory(
    storage=storage,
    session_id="session_001",
    full_session_memory=True
)

agent = Agent("openai/gpt-4o", memory=memory)

task1 = Task("Explain MongoDB aggregation pipelines")
result1 = agent.do(task1)

task2 = Task("Can you give me a simple example?")
result2 = agent.do(task2)
print(result2)
```

## Params

- `database: Optional[AsyncIOMotorDatabase]` - Optional pre-existing database (user manages lifecycle)
- `client: Optional[AsyncIOMotorClient]` - Optional pre-existing client (user manages lifecycle)
- `db_url: Optional[str]` - MongoDB connection string (required if database/client not provided)
- `database_name: Optional[str]` - Name of the database (required if database not provided)
- `sessions_collection_name: str` - Name of sessions collection (default: "interaction_sessions")
- `profiles_collection_name: str` - Name of profiles collection (default: "user_profiles")
- `cultural_knowledge_collection_name: str` - Name of cultural knowledge collection (default: "cultural_knowledge")
