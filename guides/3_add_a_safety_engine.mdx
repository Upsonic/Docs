---
title: "3.Add a Safety Engine"
sidebarTitle: "3. Add a Safety Engine"
---

## What is the Safety Engine?

The Safety Engine is a powerful content filtering and policy enforcement system that helps you maintain safe, appropriate, and compliant AI interactions. Just like humans need guidelines and rules to ensure appropriate behavior, AI agents need safety policies to filter content, block inappropriate material, and protect sensitive information.

The key benefits of the Safety Engine are:

- **Content Filtering**: Automatically detect and block inappropriate content like adult material, hate speech, or sensitive topics
- **Privacy Protection**: Anonymize or redact sensitive information like phone numbers, emails, or personal data
- **Compliance**: Ensure your AI applications meet regulatory requirements and platform policies
- **Customizable**: Create your own policies or use pre-built ones for common use cases
- **Dual Protection**: Apply policies to both user input (user_policy) and agent output (agent_policy)

## Core Principles For Safety Policies

When implementing safety policies, consider these important elements:

- **Policy Types**: Choose between blocking, anonymizing, or raising exceptions based on your needs
- **Detection Methods**: Use keyword-based detection for speed or LLM-based detection for accuracy
- **Input vs Output**: Apply user_policy to filter incoming requests and agent_policy to filter outgoing responses
- **Language Support**: Policies can detect and respond in multiple languages automatically
- **Confidence Thresholds**: Policies use confidence scores to determine when to take action

### Understanding Policy Actions

**Blocking Policies**: Completely prevent content from being processed and return a block message
**Anonymization Policies**: Replace sensitive information with safe alternatives while preserving context
**Exception Policies**: Raise exceptions that stop execution when inappropriate content is detected

## Policy Types and Use Cases

### Blocking Policies

- **CryptoBlockPolicy**: Essential for banks and financial institutions to comply with anti-money laundering (AML) and Know Your Customer (KYC) regulations
- **AdultContentBlockPolicy**: Required for professional banking environments and customer-facing applications
- **SensitiveSocialBlockPolicy**: Critical for maintaining professional communication standards in financial services

### Anonymization Policies

- **AnonymizePhoneNumbersPolicy**: Protects customer PII (Personally Identifiable Information) by replacing phone numbers with safe alternatives
- **AnonymizePhoneNumbersPolicy_LLM_Finder**: Uses AI for more accurate detection of phone numbers and other sensitive data in customer communications

### Exception Policies

- **CryptoRaiseExceptionPolicy**: Raises exceptions for compliance logging and regulatory reporting when crypto-related content is detected
- **AdultContentRaiseExceptionPolicy**: Stops execution and logs incidents for audit trails in professional banking environments

## Let's Create a Banking Assistant with Compliance Controls

In this example, we'll create a banking assistant that enforces financial regulations and protects sensitive customer information.

```python
# Upsonic Docs: Add a Safety Engine
# https://docs.upsonic.ai/guides/3_add_a_safety_engine

# Imports
from upsonic import Agent, Task
from upsonic.safety_engine import CryptoBlockPolicy, AnonymizePhoneNumbersPolicy, SensitiveSocialBlockPolicy

# Banking Assistant with Multiple Safety Policies
banking_assistant = Agent(
    name="Banking Assistant V1",
    role="Certified banking assistant providing financial guidance",
    goal="Help customers with banking services while maintaining regulatory compliance and data protection",
    instructions="""
    You are a banking assistant. Provide information about traditional banking products 
    like savings accounts, checking accounts, loans, and investment products.
    Always comply with banking regulations and protect customer privacy.
    """,
    user_policy=CryptoBlockPolicy,  # Block cryptocurrency content per banking regulations
    agent_policy=AnonymizePhoneNumbersPolicy  # Protect customer phone numbers in responses
)

# Test Task with Crypto Content (Should be Blocked)
crypto_task = Task(
    description="I want to invest in Bitcoin and Ethereum through my bank account. Can you help me set up crypto trading?",
    response_format=str
)

# Test Task with Safe Banking Content (Should Pass)
safe_task = Task(
    description="I'm 25 years old and want to open a high-yield savings account. What are the best options available?",
    response_format=str
)

# Test Task with Sensitive Information (Should be Anonymized)
privacy_task = Task(
    description="My phone number is +1-555-123-4567. Can you help me update my contact information?",
    response_format=str
)

# Run the tasks
print("=== Testing Crypto Content (Should be Blocked) ===")
banking_assistant.print_do(crypto_task)

print("\n=== Testing Safe Banking Content (Should Pass) ===")
banking_assistant.print_do(safe_task)

print("\n=== Testing Privacy Protection (Should Anonymize) ===")
banking_assistant.print_do(privacy_task)

print("Crypto Task Result:", crypto_task.response)
print("Safe Task Result:", safe_task.response[:100] + "...")
print("Privacy Task Result:", privacy_task.response)
```

Need more advanced features? The Safety Engine supports many powerful configuration options including:

- **Multiple Policy Types**: Combine blocking, anonymization, and exception policies  for comprehensive regulatory compliance
- **LLM-Enhanced Detection**: Use AI-powered content detection for better accuracy in identifying financial risks and compliance violations
- **Privacy Protection**: Automatically anonymize sensitive customer information like SSNs, account numbers, and personal data
- **Custom Policy Configuration**: Create tailored policies with specific language support for international banking operations
- **Dual Protection**: Apply different policies to customer input (user_policy) and agent responses (agent_policy) for complete coverage
- **Language Support**: Automatic language detection and localized responses for global banking and fintech applications
- **Audit Trail**: Monitor policy triggers, confidence scores, and compliance actions for regulatory reporting and risk management

For detailed examples and advanced patterns, see our comprehensive Safety Engine Concept Documentation.